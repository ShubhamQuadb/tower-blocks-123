<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no" />
    <meta name="theme-color" content="#000000" />
    <title>Pacman - Android</title>
    
    <!-- App Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiBmaWxsPSIjMDAwMDAwIi8+CjxjaXJjbGUgY3g9IjE2IiBjeT0iMTYiIHI9IjEyIiBmaWxsPSIjRkZGRjAwIi8+CjxjaXJjbGUgY3g9IjE2IiBjeT0iMTIiIHI9IjIiIGZpbGw9IiMwMDAwMDAiLz4KPHBhdGggZD0iTTE2IDE2IEwyNCA4IEwxNiAxNiBMMTYgMjQiIGZpbGw9IiMwMDAwMDAiLz4KPC9zdmc+">
    <link rel="icon" type="image/png" sizes="16x16" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiBmaWxsPSIjMDAwMDAwIi8+CjxjaXJjbGUgY3g9IjgiIGN5PSI4IiByPSI2IiBmaWxsPSIjRkZGRjAwIi8+CjxjaXJjbGUgY3g9IjgiIGN5PSI2IiByPSIxIiBmaWxsPSIjMDAwMDAwIi8+CjxwYXRoIGQ9Ik04IDggTDEyIDQgTDggOCBMOCAxMiIgZmlsbD0iIzAwMDAwMCIvPgo8L3N2Zz4=">
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxODAiIGhlaWdodD0iMTgwIiBmaWxsPSIjMDAwMDAwIi8+CjxjaXJjbGUgY3g9IjkwIiBjeT0iOTAiIHI9IjcwIiBmaWxsPSIjRkZGRjAwIi8+CjxjaXJjbGUgY3g9IjkwIiBjeT0iNjAiIHI9IjEwIiBmaWxsPSIjMDAwMDAwIi8+CjxwYXRoIGQ9Ik05MCA5MCBMMTQwIDQwIEw5MCA5MCBMOTAgMTQwIiBmaWxsPSIjMDAwMDAwIi8+Cjwvc3ZnPg==">
    <link rel="shortcut icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiBmaWxsPSIjMDAwMDAwIi8+CjxjaXJjbGUgY3g9IjE2IiBjeT0iMTYiIHI9IjEyIiBmaWxsPSIjRkZGRjAwIi8+CjxjaXJjbGUgY3g9IjE2IiBjeT0iMTIiIHI9IjIiIGZpbGw9IiMwMDAwMDAiLz4KPHBhdGggZD0iTTE2IDE2IEwyNCA4IEwxNiAxNiBMMTYgMjQiIGZpbGw9IiMwMDAwMDAiLz4KPC9zdmc+">
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Permanent+Marker" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- Splash Screen -->
    <div id="splash" style="position:fixed;inset:0;background:#000;display:flex;align-items:center;justify-content:center;flex-direction:column;z-index:1000;color:#0ff;font-family:'Permanent Marker', cursive;">
      <div style="font-size:28px;margin-bottom:8px;">PACMAN</div>
      <div id="eat-row" style="display:flex;align-items:center;gap:12px;margin:6px 0;">
        <svg id="pacSvg" width="44" height="44" viewBox="0 0 40 40" aria-label="Pacman icon">
          <circle cx="20" cy="20" r="18" fill="#ffeb3b"></circle>
          <circle cx="24" cy="14" r="3" fill="#000"></circle>
          <polygon id="mouth" points="20,20 40,10 40,30" fill="#000"></polygon>
        </svg>
        <span class="dot" style="color:#6ff;font-size:18px;">‚óè</span>
        <span class="dot" style="color:#6ff;font-size:18px;">‚óè</span>
        <span class="dot" style="color:#6ff;font-size:18px;">‚óè</span>
        <span class="dot" style="color:#6ff;font-size:18px;">‚óè</span>
        <span class="dot" style="color:#6ff;font-size:18px;">‚óè</span>
      </div>
      <div style="font-size:14px;color:#9ff">Loading‚Ä¶</div>
    </div>

    <!-- Home Screen (shown before game start) -->
    <div id="home" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:900;overflow:hidden;">
      <!-- Modern banner background (behind card) -->
      <div aria-hidden="true" style="position:absolute;inset:0;background:url('./wp13214700-pacman-iphone-wallpapers.jpg') center/cover no-repeat;
      "></div>
      <!-- Accent shapes -->
      <div aria-hidden="true" style="position:absolute;top:-60px;left:-60px;width:240px;height:240px;border-radius:50%;background:linear-gradient(145deg,#00ffa3,#00ccff);filter:blur(20px);opacity:.25"></div>
      <div aria-hidden="true" style="position:absolute;bottom:-70px;right:-50px;width:280px;height:280px;border-radius:50%;background:linear-gradient(145deg,#00ccff,#7c3aed);filter:blur(24px);opacity:.22"></div>
      <!-- 3D banner scene: Pacman and enemies -->
      <style>
        /* Inline styles limited to the home scene */
        #home .scene{position:absolute;inset:0;display:block;pointer-events:none;perspective:1000px}
        #home .stage{position:absolute;left:50%;top:36%;width:92%;max-width:760px;height:190px;transform:translateX(-50%) rotateX(6deg) rotateY(-5deg);transform-style:preserve-3d;filter:drop-shadow(0 14px 26px rgba(0,0,0,.4))}
        #home .track{position:absolute;left:0;right:0;top:55%;height:5px;margin-top:-2.5px;background:linear-gradient(90deg,rgba(255,255,255,.3) 0 14px,rgba(255,255,255,0) 14px 30px);transform:translateZ(-50px)}
        #home .pac{position:absolute;left:110px;top:55%;width:68px;height:68px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#fff176 0%,#ffca28 50%,#f5a623 100%);outline:3px solid rgba(255,255,255,.2);transform:translateY(-50%) translateZ(28px)}
        #home .pac:before{content:"";position:absolute;left:34px;top:14px;width:9px;height:9px;border-radius:50%;background:#0b1020;box-shadow:0 0 0 2px rgba(255,255,255,.2) inset}
        #home .pac .mouth{position:absolute;left:32px;top:34px;width:40px;height:40px;background:conic-gradient(#0b0f1a 0 60deg,transparent 60deg 300deg,#0b0f1a 300deg);border-radius:0 50% 50% 50%;transform:translate(-50%,-50%)}
        #home .dot{position:absolute;top:55%;width:12px;height:12px;border-radius:50%;background:rgba(255,255,255,.95);box-shadow:0 0 10px rgba(255,255,255,.6);transform:translateY(-50%) translateZ(6px)}
        #home .d1{left:180px}#home .d2{left:240px}#home .d3{left:300px}#home .d4{left:360px}#home .d5{left:420px}
        #home .ghost{position:absolute;top:55%;width:58px;height:64px;border-radius:28px 28px 12px 12px;background:radial-gradient(circle at 30% 20%,rgba(255,255,255,.28) 0 24%,transparent 26%),var(--gcol);
          transform:translateY(-50%) translateZ(22px);box-shadow:0 12px 22px rgba(0,0,0,.3);outline:3px solid rgba(255,255,255,.18)}
        #home .ghost:before,#home .ghost:after{content:"";position:absolute;top:18px;width:14px;height:14px;border-radius:50%;background:#fff}
        #home .ghost:before{left:12px}#home .ghost:after{left:31px}
        #home .ghost .pupil{position:absolute;top:24px;left:18px;width:9px;height:9px;border-radius:50%;background:#08243f}
        #home .g1{--gcol:#22d3ee;left:500px}
        #home .g2{--gcol:#f472b6;left:570px}
        #home .g3{--gcol:#fb7185;left:640px}
      </style>
      
      <div class="scene" aria-hidden="true">
        <div class="stage">
          <div class="track"></div>
          <div class="pac"><div class="mouth"></div></div>
          <div class="dot d1"></div>
          <div class="dot d2"></div>
          <div class="dot d3"></div>
          <div class="dot d4"></div>
          <div class="dot d5"></div>
          <div class="ghost g1"><div class="pupil"></div></div>
          <div class="ghost g2"><div class="pupil"></div></div>
          <div class="ghost g3"><div class="pupil"></div></div>
        </div>
      </div>
      <!-- Content card (above banner) -->
      <div style="position:relative;z-index:2;width:92%;max-width:520px;border-radius:14px;background:rgba(6,12,20,.78);backdrop-filter:blur(6px);padding:16px;border:1px solid rgba(0,204,255,.25);box-shadow:0 12px 40px rgba(0,0,0,.35);text-align:center;color:#eafffb;">
        <div style="font-family:'Permanent Marker', cursive;font-size:26px;letter-spacing:1px;color:#35f7c6;margin-bottom:6px;">Pacman</div>
        <div style="font-size:12px;color:#bfe8ff;opacity:.95;margin-bottom:14px;">Modern Smartphone Edition</div>
        <button id="btnStartGame" style="width:100%;padding:12px 10px;margin:6px 0;background:linear-gradient(90deg,#00ffaa,#00ccff);border:none;border-radius:10px;color:#001;font-weight:700;letter-spacing:.5px;box-shadow:0 6px 16px rgba(0,204,255,.35);">START GAME</button>
        <button id="btnHelp" style="width:100%;padding:10px;margin:6px 0;background:rgba(13,34,48,.9);border:1px solid rgba(0,170,255,.45);border-radius:10px;color:#bfe8ff;">HELP</button>
      </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" style="position:fixed;inset:0;background:rgba(0,0,0,.75);display:none;align-items:center;justify-content:center;z-index:950;">
      <div style="width:92%;max-width:560px;background:#0b1116;border:1px solid #0aa;border-radius:10px;color:#d9f7ff;padding:14px;">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
          <div style="font-weight:700;color:#6df;">How to Play</div>
          <button id="btnCloseHelp" style="background:#07202c;color:#9ad;border:1px solid #0aa;border-radius:6px;padding:6px 10px;">Close</button>
        </div>
        <ul style="margin:0;padding-left:18px;line-height:1.6;color:#bfe8ff;text-align:left;">
          <li>Use the on-screen arrows to move Pac-Man.</li>
          <li>Eat all dots to clear the level.</li>
          <li>Power pills make ghosts vulnerable for a short time.</li>
          <li>Tap Start to begin a new game.</li>
          <li>Use the Sound button to toggle audio on/off.</li>
          <li>Tap Pause to pause or resume gameplay.</li>
        </ul>
      </div>
    </div>
    <div id="shim">shim for font face</div>
    <h1>üéÆ Pacman - Android</h1>
    <p id="instructions">
      Tap the arrow buttons to move Pac-Man and eat all dots
    </p>

    <!-- Game Wrapper (hidden initially, shown when game starts) -->
    <div class="game-wrapper" style="display:none;">
      <div id="pacman" aria-label="Pacman Canvas Wrapper"></div>
    </div>

    <!-- Mobile Controls -->
    <div class="controls" aria-label="Mobile Controls">
      <!-- Top row: Sound, Start and Pause buttons -->
      <div class="controls-row controls-top">
        <button class="pill-btn sound-btn" data-key="83" aria-label="Toggle Sound (S)">üîä Sound</button>
        <button class="pill-btn btn-start" data-key="78" aria-label="Start (N)">‚ñ∂ Start</button>
        <button class="pill-btn btn-pause" data-key="80" aria-label="Pause/Resume (P)" style="display:none;">‚è∏ Pause</button>
      </div>
      <!-- Bottom row: Arrow buttons -->
      <div class="controls-row">
        <button class="ctrl-btn btn-up" data-key="38" aria-label="Up">‚ñ≤</button>
      </div>
      <div class="controls-row">
        <button class="ctrl-btn btn-left" data-key="37" aria-label="Left">‚óÄ</button>
        <button class="ctrl-btn btn-down" data-key="40" aria-label="Down">‚ñº</button>
        <button class="ctrl-btn btn-right" data-key="39" aria-label="Right">‚ñ∂</button>
      </div>
    </div>

    <script src="jiogames_sp_wrapper.js" type="text/javascript"></script>
    <script>
        // Console logging for smartphone SDK
        console.log("Pacman - Smartphone SDK initialized");
        window.addEventListener('load', function() {
            console.log("Pacman Smartphone - Page Loaded");
            // Note: cacheAd() will be called ONLY at game start (in startNewGame())
            // NOT during initialization per JioGames guidelines
            
            // Hide splash immediately after load, then show home (no glitch)
          setTimeout(function(){
            var s=document.getElementById('splash'); if(s){ s.style.display='none'; }
            var h=document.getElementById('home'); if(h){ h.style.display='flex'; document.body.classList.add('home-visible'); }
          }, 300);
            
            // Load banner immediately on page load (like Space Battle)
            try{
                        loadBanner();
                        console.log("Pacman: Banner loading started");
                        // Show banner after it loads
                        setTimeout(function(){ 
                                showBanner(); 
                    setBottomBanner(); 
                        }, 1000);
                } catch(e) { console.log(e); }
            
            // Note: cacheAd() will be called ONLY at game start (in startNewGame())
            // NOT during initialization per JioGames guidelines
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js" type="text/javascript"></script>
    <script src="./app.js" type="text/javascript"></script>

    <!-- Touch/Click Controls Script -->
    <script>
      (function() {
        function fireKey(code) {
          try {
            const ev = new KeyboardEvent('keydown', {bubbles: true, cancelable: true, keyCode: code, which: code});
            Object.defineProperty(ev, 'keyCode', {get: function(){return code;}});
            Object.defineProperty(ev, 'which', {get: function(){return code;}});
            document.dispatchEvent(ev);
          } catch (e) {
            // Fallback for older browsers
            const ev = document.createEvent('Event');
            ev.initEvent('keydown', true, true);
            ev.keyCode = code;
            ev.which = code;
            document.dispatchEvent(ev);
          }
        }

        // handle tap & press-and-hold to repeat
        let repeatTimer = null;
        const REPEAT_MS = 120; // Faster response for smartphones

        function startRepeat(code) {
          fireKey(code);
          clearInterval(repeatTimer);
          repeatTimer = setInterval(function(){ fireKey(code); }, REPEAT_MS);
        }
        function stopRepeat() {
          clearInterval(repeatTimer);
          repeatTimer = null;
        }

        function bindBtn(btn) {
          const code = parseInt(btn.getAttribute('data-key'), 10);
          // Mouse
          btn.addEventListener('mousedown', function(){ startRepeat(code); });
          btn.addEventListener('mouseup', stopRepeat);
          btn.addEventListener('mouseleave', stopRepeat);
          btn.addEventListener('click', function(e){ e.preventDefault(); });
          // Touch (better for Android)
          btn.addEventListener('touchstart', function(e){ 
            e.preventDefault(); 
            startRepeat(code);
            // Haptic feedback for Android
            if (navigator.vibrate) {
              navigator.vibrate(10);
            }
          }, {passive:false});
          btn.addEventListener('touchend', function(e){ e.preventDefault(); stopRepeat(); }, {passive:false});
          btn.addEventListener('touchcancel', stopRepeat, {passive:true});
        }

        document.addEventListener('DOMContentLoaded', function(){
          document.querySelectorAll('.ctrl-btn, .pill-btn').forEach(bindBtn);
          // Splash Pacman eating animation
          (function(){
            var mouth = document.getElementById('mouth');
            var dots = Array.prototype.slice.call(document.querySelectorAll('#eat-row .dot'));
            var open = true, i = 0;
            setInterval(function(){
              // toggle mouth shape
              if (mouth) {
                mouth.setAttribute('points', open ? '20,20 40,19 40,21' : '20,20 40,10 40,30');
                open = !open;
              }
              // eat a dot every other toggle
              if (!open && dots.length) {
                if (i < dots.length) {
                  dots[i].style.opacity = '0';
                  i++;
                } else {
                  // reset
                  dots.forEach(function(d){ d.style.opacity = '1'; });
                  i = 0;
                }
              }
            }, 200);
          })();
          // Home screen bindings
          var hs=document.getElementById('home');
          var btnStart=document.getElementById('btnStartGame');
          var btnHelp=document.getElementById('btnHelp');
          var help=document.getElementById('helpModal');
          var btnClose=document.getElementById('btnCloseHelp');
          function fireKey(code){
            try{const ev=new KeyboardEvent('keydown',{bubbles:true,cancelable:true,keyCode:code,which:code});
              Object.defineProperty(ev,'keyCode',{get:function(){return code;}});
              Object.defineProperty(ev,'which',{get:function(){return code;}});
              document.dispatchEvent(ev);
            }catch(e){}
          }
          if(btnStart){ btnStart.addEventListener('click',function(){
            var home=document.getElementById('home');
            if(home){ 
              home.style.display='none'; 
              // Don't remove home-visible class yet - wait for game to actually start
              // It will be removed when gamePlaying event fires
            }
            // Hide banner when game starts (direct call like Space Battle)
            try{ hideBanner(); }catch(e){}
            setTimeout(function(){ 
              fireKey(78); // 'N' to start
              // Toggle buttons: Start will be hidden and Pause shown by gamePlaying event
            }, 150);
          }); }
          if(btnHelp){ btnHelp.addEventListener('click',function(){ if(help){ help.style.display='flex'; } }); }
          if(btnClose){ btnClose.addEventListener('click',function(){ if(help){ help.style.display='none'; } }); }
          
          // Sound button icon toggle logic
          const soundBtn = document.querySelector('.sound-btn');
          if (soundBtn) {
            // Initial state check
            function updateSoundIcon() {
              const isSoundDisabled = localStorage["soundDisabled"] === "true";
              soundBtn.innerHTML = isSoundDisabled ? 'üîá Sound' : 'üîä Sound';
            }
            
            // Update icon on click and keypress
            soundBtn.addEventListener('click', function() {
              // Fire 'S' key event to trigger sound toggle
              fireKey(83);
              setTimeout(updateSoundIcon, 200); // Wait for localStorage to update
            });
            
            // Listen for 'S' key press to update icon
            document.addEventListener('keydown', function(e) {
              if (e.keyCode === 83) { // 'S' key
                setTimeout(updateSoundIcon, 200);
              }
            });
            
            // Set initial state
            updateSoundIcon();
            
            // Refresh icon every second to ensure sync
            setInterval(updateSoundIcon, 1000);
          }
          
          // Two separate buttons: Start and Pause - one active at a time
          var startBtn = null;
          var pauseBtn = null;
          var currentGameState = 'WAITING';
          
          // Function to update button states (enable/disable)
          function updateButtonStates(newState) {
            currentGameState = newState;
            
            if (!startBtn) startBtn = document.querySelector('.btn-start');
            if (!pauseBtn) pauseBtn = document.querySelector('.btn-pause');
            
            if (!startBtn || !pauseBtn) return;
            
            if (newState === 'WAITING') {
              // Show Start (enabled), hide Pause
              startBtn.style.display = 'inline-flex';
              startBtn.disabled = false;
              startBtn.style.opacity = '1';
              startBtn.style.cursor = 'pointer';
              startBtn.classList.remove('btn-disabled');
              
              pauseBtn.style.display = 'none';
              pauseBtn.disabled = true;
              console.log('Pacman: Start enabled, Pause hidden');
              
            } else if (newState === 'PLAYING' || newState === 'COUNTDOWN') {
              // Hide Start, show Pause (enabled)
              startBtn.style.display = 'none';
              startBtn.disabled = true;
              startBtn.classList.add('btn-disabled');
              
              pauseBtn.style.display = 'inline-flex';
              pauseBtn.disabled = false;
              pauseBtn.style.opacity = '1';
              pauseBtn.style.cursor = 'pointer';
              pauseBtn.classList.remove('btn-disabled');
              pauseBtn.innerHTML = '‚è∏ Pause';
              console.log('Pacman: Start hidden/disabled, Pause enabled');
              
            } else if (newState === 'PAUSE') {
              // Show Start (enabled), show Pause (disabled - dim, not clickable)
              startBtn.style.display = 'inline-flex';
              startBtn.disabled = false;
              startBtn.style.opacity = '1';
              startBtn.style.cursor = 'pointer';
              startBtn.classList.remove('btn-disabled');
              
              pauseBtn.style.display = 'inline-flex';
              pauseBtn.disabled = true;
              pauseBtn.style.opacity = '0.5';
              pauseBtn.style.cursor = 'not-allowed';
              pauseBtn.classList.add('btn-disabled');
              pauseBtn.innerHTML = '‚ñ∂ Resume';
              console.log('Pacman: Start enabled, Pause disabled (dim)');
            }
          }
          
          // Set up event listeners IMMEDIATELY
          window.addEventListener('gameWaiting', function() {
            console.log('Pacman: Received gameWaiting event');
            updateButtonStates('WAITING');
          });
          
          window.addEventListener('gamePlaying', function() {
            console.log('Pacman: Received gamePlaying event');
            // Remove home-visible class when game actually starts playing (controls should show now)
            document.body.classList.remove('home-visible');
            updateButtonStates('PLAYING');
          });
          
          window.addEventListener('gamePaused', function() {
            console.log('Pacman: Received gamePaused event');
            updateButtonStates('PAUSE');
          });
          
          // Set up button click handlers
          setTimeout(function() {
            startBtn = document.querySelector('.btn-start');
            pauseBtn = document.querySelector('.btn-pause');
            
            if (startBtn) {
              startBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                if (this.disabled) {
                  console.log('Pacman: Start button is disabled, ignoring click');
                  return;
                }
                
                console.log('Pacman: Start button clicked');
                
                // Disable Start button immediately (dim, not clickable)
                this.disabled = true;
                this.style.opacity = '0.5';
                this.style.cursor = 'not-allowed';
                this.classList.add('btn-disabled');
                
                // Show and enable Pause button
                if (pauseBtn) {
                  pauseBtn.style.display = 'inline-flex';
                  pauseBtn.disabled = false;
                  pauseBtn.style.opacity = '1';
                  pauseBtn.style.cursor = 'pointer';
                  pauseBtn.classList.remove('btn-disabled');
                  pauseBtn.innerHTML = '‚è∏ Pause';
                }
                
                // Fire N key to start game
                setTimeout(function() {
                  fireKey(78);
                }, 50);
              });
            }
            
            if (pauseBtn) {
              pauseBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                if (this.disabled) {
                  console.log('Pacman: Pause button is disabled, ignoring click');
                  return;
                }
                
                console.log('Pacman: Pause button clicked, current state:', currentGameState);
                
                if (currentGameState === 'PLAYING' || currentGameState === 'COUNTDOWN') {
                  // Pause the game - disable Pause, enable Start
                  this.disabled = true;
                  this.style.opacity = '0.5';
                  this.style.cursor = 'not-allowed';
                  this.classList.add('btn-disabled');
                  this.innerHTML = '‚ñ∂ Resume';
                  
                  // Enable Start button
                  if (startBtn) {
                    startBtn.style.display = 'inline-flex';
                    startBtn.disabled = false;
                    startBtn.style.opacity = '1';
                    startBtn.style.cursor = 'pointer';
                    startBtn.classList.remove('btn-disabled');
                  }
                  
                  // Fire P key to pause
                  setTimeout(function() {
                    fireKey(80);
                  }, 50);
                  
                } else if (currentGameState === 'PAUSE') {
                  // Resume the game - disable Start, enable Pause
                  if (startBtn) {
                    startBtn.disabled = true;
                    startBtn.style.opacity = '0.5';
                    startBtn.style.cursor = 'not-allowed';
                    startBtn.classList.add('btn-disabled');
                  }
                  
                  // Enable Pause button
                  this.disabled = false;
                  this.style.opacity = '1';
                  this.style.cursor = 'pointer';
                  this.classList.remove('btn-disabled');
                  this.innerHTML = '‚è∏ Pause';
                  
                  // Fire P key to resume
                  setTimeout(function() {
                    fireKey(80);
                  }, 50);
                }
              });
            }
            
            // Initial state
            updateButtonStates('WAITING');
            
            // Export for debugging
            window.pacmanButtonState = {
              getState: function() { return currentGameState; },
              setState: function(s) { updateButtonStates(s); }
            };
          }, 100);
        });
      })();
    </script>
  </body>
</html>


